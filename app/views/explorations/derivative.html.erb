<script>
var Preview = {
    Update: function () {
	var text = document.getElementById("MathInput").value; 
	if (text.length > 0) {
	    var math = MathJax.Hub.getAllJax($("#MathPreview")[0])[0];
	    try
	    {
                var f = MathFunction.parse(text);
                var text = MathFunction.parse(text).tex();
		var text = '\\frac{d}{dx} ' + text + ' = ' + f.derivative("x").tex();
		MathJax.Hub.Queue(["Text",math,text]);
		$("#MathFunctionError").hide();
		$("#MathPreview").show();
                var story = f.derivative_story("x");
		$('#solution').empty();
		for( var i = 0; i < story.length; i++ ) {
		    $("<div>" + story[i] + "</div>").appendTo("#solution");
		}

		$('#solution code').each( function() {
		    var text = $(this).text();
		    var script=document.createElement('script');
		    script.type='math/tex';
		    $(script).append( $(this).text() );
		    $(this).replaceWith( script );
		});

		$("#solution").show();
		MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
		$("#claim").show();
	    }
	    catch(err)
	    {
		$("#MathFunctionError").show();
		$("#MathPreview").hide();
		$("#solution").hide();
		$("#claim").hide();
	    }
	} else {
	    $("#MathPreview").hide();
	    $("#solution").hide();
	    $("#claim").hide();
	}
    },
};

</script>

<p>Enter a function, and see how to differentiate it.</p>

<input class="function" id="MathInput" onkeyup="Preview.Update()" autocomplete="off" type="text" value="" />

<div id="claim" style="display: none; font-family: 'Computer Modern';">I claim that <span id="MathPreview"><script type="math/tex"></script></span>.</div>
<div id="MathFunctionError" style="display: none; font-weight: bold; color: red;">Error: the expression is invalid.</div>

<div id="solution" style="display: none; font-family: 'Computer Modern';"></div>
